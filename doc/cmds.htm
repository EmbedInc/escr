<html lang="en-US">
<head>
  <link rel="stylesheet" href="../../../document.css"></link>
  <link rel="stylesheet" href="../../document.css"></link>
  <link rel="stylesheet" href="../document.css"></link>
  <link rel="stylesheet" href="document.css"></link>
  <title>ESCR Scripting System</title>
  </head>
<body>

<h1 class=page>ESCR Program and Callable System</h1>
<p class=page>Last updated 18 April 2020</p>

<ul>
  <li><a href="func.htm">Next page</a>
  <li><a href="sym.htm">Previous page</a>
  <li><a href="index.htm">Master index</a>
  </ul>

<!-- *********************************************************************** -->
<br><h1>Commands</h1>

<ul>
  <li>Listed alphabetically

    <p>
    <a href="#append">APPEND</a>&nbsp;
    <a href="#block">BLOCK</a>&nbsp;
    <a href="#call">CALL</a>&nbsp;
    <a href="#command">COMMAND</a>&nbsp;
    <a href="#const">CONST</a>&nbsp;
    <a href="#del">DEL</a>&nbsp;
    <a href="#dir">DIR</a>&nbsp;
    <a href="#endblock">ENDBLOCK</a>&nbsp;
    <a href="#endcmd">ENDCMD</a>&nbsp;
    <a href="#endfunc">ENDFUNC</a>&nbsp;
    <a href="#endloop">ENDLOOP</a>&nbsp;
    <a href="#endmac">ENDMAC</a>&nbsp;
    <a href="#endsub">ENDSUB</a>&nbsp;
    <a href="#funcstr">FUNCSTR</a>&nbsp;
    <a href="#function">FUNCTION</a>&nbsp;
    <a href="#funcval">FUNCVAL</a>&nbsp;
    <a href="#if">IF</a>&nbsp;
    <a href="#include">INCLUDE</a>&nbsp;
    <a href="#loop">LOOP</a>&nbsp;
    <a href="#macro">MACRO</a>&nbsp;
    <a href="#quit">QUIT</a>&nbsp;
    <a href="#quitmac">QUITMAC</a>&nbsp;
    <a href="#repeat">REPEAT</a>&nbsp;
    <a href="#return">RETURN</a>&nbsp;
    <a href="#run">RUN</a>&nbsp;
    <a href="#set">SET</a>&nbsp;
    <a href="#show">SHOW</a>&nbsp;
    <a href="#stop">STOP</a>&nbsp;
    <a href="#subroutine">SUBROUTINE</a>&nbsp;
    <a href="#sylist">SYLIST</a>&nbsp;
    <a href="#var">VAR</a>&nbsp;
    <a href="#write">WRITE</a>&nbsp;
    <a href="#writepop">WRITEPOP</a>&nbsp;
    <a href="#writepush">WRITEPUSH</a>&nbsp;

  <li>Blocks and routines

    <p>
    <a href="#block">BLOCK</a>&nbsp;
    <a href="#repeat">REPEAT</a>&nbsp;
    <a href="#quit">QUIT</a>&nbsp;
    <a href="#endblock">ENDBLOCK</a>&nbsp; - &nbsp; Basic blocks<br>

    <a href="#subroutine">SUBROUTINE</a>&nbsp;
    <a href="#return">RETURN</a>&nbsp;
    <a href="#endsub">ENDSUB</a>&nbsp;
    <a href="#call">CALL</a>&nbsp; - &nbsp; Subroutines<br>

    <a href="#macro">MACRO</a>&nbsp;
    <a href="#quitmac">QUITMAC</a>&nbsp;
    <a href="#endmac">ENDMAC</a>&nbsp; - &nbsp; Macros<br>

    <a href="#function">FUNCTION</a>&nbsp;
    <a href="#funcval">FUNCVAL</a>&nbsp;
    <a href="#funcstr">FUNCSTR</a>&nbsp;
    <a href="#return">RETURN</a>&nbsp;
    <a href="#endfunc">ENDFUNC</a>&nbsp; - &nbsp; Functions<br>

    <a href="#command">COMMAND</a>&nbsp;
    <a href="#return">RETURN</a>&nbsp;
    <a href="#endcmd">ENDCMD</a>&nbsp; - &nbsp; Commands<br>

  <li>Symbols

    <p>
    <a href="#const">CONST</a>&nbsp; - &nbsp; Define constant<br>
    <a href="#var">VAR</a>&nbsp; - &nbsp; Define variable<br>
    <a href="#del">DEL</a>&nbsp; - &nbsp; Delete symbol<br>
    <a href="#set">SET</a>&nbsp; - &nbsp; Set variable to value<br>
    <a href="#append">APPEND</a>&nbsp; - &nbsp; Append to string variable<br>
    <a href="#sylist">SYLIST</a>&nbsp; - &nbsp; List symbols<br>

  <li>Conditional execution

    <p>
    <a href="#if">IF</a>&nbsp; - &nbsp; If ... then ... else<br>

  <li>Looping

    <p>
    <a href="#loop">LOOP</a>&nbsp; - &nbsp; Start loop<br>
      &nbsp; &nbsp; <a href="#loop-unconditional">unconditional</a>&nbsp;
        - &nbsp; No automatic end<br>
      &nbsp; &nbsp; <a href="#loop-counted">counted</a>&nbsp;
        - &nbsp; Integer, fixed increment/decrement<br>
        &nbsp; &nbsp; &nbsp; &nbsp; <a href="#loop-with">WITH</a>&nbsp;
          - &nbsp; Define loop variable<br>
        &nbsp; &nbsp; &nbsp; &nbsp; <a href="#loop-from">FROM</a>&nbsp;
          - &nbsp; Starting value<br>
        &nbsp; &nbsp; &nbsp; &nbsp; <a href="#loop-to">TO</a>&nbsp;
          - &nbsp; Ending value<br>
        &nbsp; &nbsp; &nbsp; &nbsp; <a href="#loop-n">N</a>&nbsp;
          - &nbsp; Number of iterations<br>
        &nbsp; &nbsp; &nbsp; &nbsp; <a href="#loop-by">BY</a>&nbsp;
          - &nbsp; Increment<br>
      &nbsp; &nbsp; <a href="#loop-symbols">SYMBOLS</a>&nbsp;
        - &nbsp; Preprocessor symbols<br>
      &nbsp; &nbsp; <a href="#loop-directory">DIR</a>&nbsp;
        - &nbsp; Directory entries<br>
    <a href="#repeat">REPEAT</a>&nbsp; - &nbsp; Next iteration<br>
    <a href="#quit">QUIT</a>&nbsp; - &nbsp; Exit loop<br>
    <a href="#endloop">ENDLOOP</a>&nbsp; - &nbsp; End loop definition<br>

  <li>Host operating system

    <p>
    <a href="#del">DEL</a>&nbsp; - &nbsp; Delete<br>
    <a href="#dir">DIR</a>&nbsp; - &nbsp; manipulate directories<br>
    <a href="#run">RUN</a>&nbsp; - &nbsp; Run external program<br>

  <li>Input and output

    <p>
    <a href="#show">SHOW</a>&nbsp; - &nbsp; Write to standard output<br>
    <a href="#write">WRITE</a>&nbsp; - &nbsp; Write to file or preprocessor output<br>
    <a href="#writepush">WRITEPUSH</a>&nbsp; - &nbsp; New writing state, save old<br>
    <a href="#writepop">WRITEPOP</a>&nbsp; - &nbsp; Restore previous writing state<br>

  <li>Scripting system

    <p>
    <a href="#include">INCLUDE</a>&nbsp; - &nbsp; Include file as source<br>
    <a href="#stop">STOP</a>&nbsp; - &nbsp; End execution<br>

  </ul>


<p>Commands are whole source lines that cause specific actions to be taken
by the scripting system.  Commands start with the command name, which is
possibly followed by parameters.  The command name and parameters are
separated from each other by one or more spaces.

<p>There are two types of commands, intrinsic and user-defined.

<p>Intrinsic commands are built into the ESCR system.  They are all
available by default.  Applications can remove specific intrinsic commands
and add their own.  The ESCR program leaves all the default intrinsic
commands and defines none of its own.

<p>User-defined commands are defined by script code using the <a
href="#command">COMMAND</a> command.  Once defined, these commands are
indistiguishable from intrinsic commands to code that invokes them.  See
the <a href="#command">COMMAND</a> description for more information about
user-defined commands.

<p>Command names are case-sensitive.  All intrinsic command names contain
only lower case letters.  User-defined command names can contain both
upper and lower case letters.  Parameters to the intrinsic commands are
case-insensitive to the extent possible.

<p>Depending on the application, a special sequence of characters may be
required to identify commands.  This is generally required in
pre-processor mode to distinguish commands from data.

<p>The ESCR program uses no special syntax to identify commands.  The
first non-blank character on a line is the start of a command name
keyword.

<p>The ESCR system intrinsic commands are:

<p><b><tt id="append">APPEND</b> <i>name arg ... arg</i></tt></p><indent>

  <p>Append the concatenation of all the <i>arg</i> arguments to the end
  of the string in the variable <i>name</i>.  <i>Name</i> must be the name
  of a variable with <b>string</b> data type.

  </p></indent>

<p><tt id="block"><b>BLOCK</b></tt></p><indent>

  <p>Starts a new execution block.  The block is ended with the
  <b>endblock</b> command.  This type of execution block can not take
  arguments.  Inside the block, the <b>arg</b> inline function will
  resolve arguments for the next innermost block that can take arguments,
  such as a <b>subroutine</b> ... <b>endsub</b> block, for example.

  </p></indent>

<p><tt id="call"><b>CALL</b> <i>name [arg ... arg]</i></tt></p><indent>

  <p>Executes the subroutine of name <i>name</i>.  Execution returns to
  after the <i>call</i> command when the subroutine ends.

  <p>There may be zero or more <i>arg</i> parameters separated by spaces.
  These become the execution block arguments inside the subroutine.  They
  are available to the subroutine via the <a
  href="func.htm#arg"><b>arg</b></a> inline function. Arguments are
  numbered sequentially starting at 1.  The special argument 0 is always
  <i>name</i>.

  <p>The arguments are interpreted as raw collection of characters.  One
  or more blanks separate arguments.  Characters enclosed in quotes
  ("...") or apostrophies ('...') are treated as one entity and are not
  broken into individual arguments even if they contain blanks. However,
  the whole string, including the enclosing quote characters, becomes the
  argument value.

  <p>Note that, as with all commands, any inline functions are first
  evaluated before the command is interpreted.

  <p>Some examples of calls to subroutine XYZ and the resulting value of
  the arguments inside the subroutine are:

  <p><tt><b>call</b> xyz</tt></p><indent>
    Arg 0: <tt>xyz</tt><br>
    </indent>

  <p><tt><b>call</b> xyz a b "a b" "don't"</tt></p><indent>
    Arg 0: <tt>xyz</tt><br>
    Arg 1: <tt>a</tt><br>
    Arg 2: <tt>b</tt><br>
    Arg 3: <tt>"a b"</tt><br>
    Arg 4: <tt>"don't"</tt><br>
    </indent>

  <p><tt><b>call</b> xyz 1 2 [<b>+</b> 3 4]</tt></p><indent>
    Arg 0: <tt>xyz</tt><br>
    Arg 1: <tt>1</tt><br>
    Arg 2: <tt>2</tt><br>
    Arg 3: <tt>7</tt><br>
    </indent>

  </p></indent>

<p><tt id="command"><b>COMMAND</b> <i>name</i></tt></p><indent>

  <p>Create a user-defined command of name <i>name</i>.

  <p>Code following <b>command</b> is considered part of the command until
  an <a href="#endcmd"> <b>endcmd</b> </a> command is encountered.  The
  code from <b>command</b> thru <b>endcmd</b> will not be executed when
  the command is being defined. User-defined commands are invoked just
  like intrinsic commands.

  <p>The code from <b>command</b> thru <b>endcmd</b> is an execution
  block.  This type of execution block can take arguments, which are taken
  from the command parameters.  Argument 0 is always the command name as
  it appeared on the command line.  Any arguments supplied to the command
  will be available in the command routine as numbered arguments starting
  at 1.  The argument passing mechanism is the same as implemented by the
  <b>call</b> command for subroutines.  See the <a href="#call">
  <b>call</b> </a> command description for how arguments are parsed from
  the command line and passed to the command routine.

  <p>When a command is invoked, execution jumps to the first line after
  the defining <b>command</b> command.  Execution continues until a <a
  href="#return"> <b>return</b> </a> or <b>endcmd</b> command is
  encountered.  Execution is then resumed on the line following the
  command invocation.

  </p></indent>

<p><tt id="const"><b>CONST</b> <i>name [dtype]</i> <b>=</b> <i>value</i></tt></p><indent>

  <p>Create a new constant of name <i>name</i>.

  <p>The optional <i>dtype</i> parameter specifies the data type of the
  constant.  The default data type is <b>string</b>.

  </p></indent>

<p><tt id="del"><b>DEL</b> <i>[objtype] name</i></tt></p><indent>

  <p>Delete the object named <i>name</i>.  <i>Objtype</i> specifies the
  type of object, and can be one of the following:</p><indent>

    <p><tt><b>SYM</b></tt></p><indent>

      <p>ESCR symbol of any type.

      </p></indent>

    <p><tt><b>VAR</b></tt></p><indent>

      <p>ESCR variable.

      </p></indent>

    <p><tt><b>CONST</b></tt></p><indent>

      <p>ESCR constant.

      </p></indent>

    <p><tt><b>VCON</b></tt></p><indent>

      <p>ESCR variable or constant.

      </p></indent>

    <p><tt><b>SUBR</b></tt></p><indent>

      <p>ESCR subroutine.

      </p></indent>

    <p><tt><b>MACRO</b></tt></p><indent>

      <p>ESCR macro.

      </p></indent>

    <p><tt><b>FUNC</b></tt></p><indent>

      <p>ESCR function.

      </p></indent>

    <p><tt><b>CMD</b></tt></p><indent>

      <p>ESCR command.

      </p></indent>

    <p><tt><b>LABEL</b></tt></p><indent>

      <p>ESCR label.

      </p></indent>

    <p><tt><b>FILE</b></tt></p><indent>

      <p>File system non-directory object.  Symbolic links are followed.
      The script will abort on error, such as <i>name</i> not found.

      </p></indent>

    <p><tt><b>TREE</b></tt></p><indent>

      <p>File system object.  Symbolic links are not followed.  If the
      file system object is a directory, then the entire tree from that
      directory on down is deleted.  On error, the ESCR integer variable
      <tt><b>EXITSTATUS</b></tt> is set to 3, otherwise to 0.
      <tt><b>EXITSTATUS</b></tt> is created if it does not already exist.
      The script exit status value is raised to what
      <tt><b>EXITSTATUS</b></tt> is set to, if previously lower.

      </p></indent>

    <p>In these cases, <i>name</i> is a string that is the name of the
    object to delete.  In the case of a ESCR symbol, the symbol name may
    be qualified.  In that case, the symbol type, if included in the
    qualifier, must match the symbol type(s) specified by <i>objtype</i>.

    </p></indent>

  <p>When <i>objtype</i> is omitted, <i>name</i> is the name of a ESCR
  symbol directly, not a string.

  </p></indent>

<p><tt id="dir"><b>DIR</b> [<i>cmd</i>] <i>directory</i></tt></p><indent>

  <p>Manipulates file system directories in the underlying operating
  system.

  <p><i>Directory</i> is a string that is the name of a directory.

  <p><i>Cmd</i> specifies the operation to perform.  It can be one of the
  following:

    <p><b><tt>GO</tt></b></p><indent>

      <p>Set the current directory to <i>directory</i>.  This is the
      default when <i>cmd</i> is not supplied.

      </p></indent>

    <p><b><tt>MAKE</tt></b></p><indent>

      <p>Creates the directory <i>directory</i>.  It is an error if
      <i>directory</i> previously exists as any file system object.

      </p></indent>

    <p><b><tt>EXIST</tt></b></p><indent>

      <p>Creates the directory <i>directory</i> if it does not already
      exist.  Nothing is done if <i>directory</i> previously exists as a
      directory.  It is an error if <i>directory</i> previously exists,
      but is not a directory.

      </p></indent>

    <p><b><tt>EXISTGO</tt></b></p><indent>

      <p>Same as EXIST followed by GO with the same <i>directory</i>. This
      command ensures that the named directory exists, then sets it as the
      current working directory.  It is an error if <i>directory</i>
      previously exists, but is not a directory.

      </p></indent>

  </p></indent>

<p><tt id="endblock"><b>ENDBLOCK</b></tt></p><indent>

  <p>Ends the definition of the current execution block, which must have
  been started with a <a href="#block"> <b>block</b> </a> command.  This
  command functions like <a href="#quit"> <b>quit</b> </a> when executed.

  </p></indent>

<p><tt id="endcmd"><b>ENDCMD</b></tt></p><indent>

  <p>Ends a command definition started with the last <a href="#command">
  <b>command</b> </a> command.  Code following this command is no longer
  considered part of the command definition, and will be executed if code
  execution was enabled when <b>command</b> was encountered.

  <p>If <b>endcmd</b> is encountered while executing a command, it
  functions just like <a href="#return"> <b>return</b> </a>.

  </p></indent>

<p><tt id="endfunc"><b>ENDFUNC</b></tt></p><indent>

  <p>Ends a function definition started with the last <a href="#function">
  <b>function</b> </a> command.  Code following this command is no longer
  considered part of the function definition, and will be executed if code
  execution was enabled when <b>function</b> was encountered.

  <p>If <b>endfunc</b> is encountered while executing a function, it acts
  like <a href="#return"> <b>return</b> </a>.

  </p></indent>

<p><tt id="endloop"><b>ENDLOOP</b></tt></p><indent>

  <p>Ends a <a href="#loop"> <b>loop</b> </a> execution block.  If this
  command is encountered when the loop is being executed, then it
  functions like <a href="#repeat"> <b>repeat</b> </a>.

  </p></indent>

<p><tt id="endmac"><b>ENDMAC</b></tt></p><indent>

  <p>Ends a macro definition started with the last <b>macro</b> command.
  Code following this command is no longer part of the macro, and will be
  executed if code execution was enabled when the <b>macro</b> command was
  encountered.  If <b>endmac</b> is encountered while executing a macro,
  then execution returns to immediately after the macro invocation (just
  like <b>quitmac</b> in this case).

  </p></indent>

<p><tt id="endsub"><b>ENDSUB</b></tt></p><indent>

  <p>Ends a subroutine definition started with the last <b>subroutine</b>
  command.  Code following this command is no longer considered part of
  the subroutine, and will be executed if code execution was enabled when
  the <b>subroutine</b> command was encountered.

  <p>If <b>endsub</b> is encountered while executing a subroutine, it
  functions just like <b>return</b>.

  </p></indent>

<p><tt id="funcstr"><b>FUNCSTR</b> <i>arg ... arg</i></tt></p><indent>

  <p>Sets the concatenation of the string representation of all the
  arguments to the return value of the innermost function being executed.
  This command is only allowed inside a function routine.

  <p>The resulting characters are returned by the function as a string,
  not as a sequence of characters.  To return raw characters, use the
  FUNCVAL command.

  <p>The return value of a function is initialized to nothing.  A FUNCSTR
  command explicitly sets the return value, replacing any previously
  defined return value.  Unlike FUNCVAL, multiple FUNCSTR commands are not
  cumulative.

  </p></indent>

<p><tt id="function"><b>FUNCTION</b> <i>name</i></tt></p><indent>

  <p>Create a user-defined function of name <i>name</i>.  <i>Name</i> will
  now refer to the new function regardless of its previous meaning, if
  any.  <i>Name</i> will revert to its previous meaning when this symbol
  is deleted.

  <p>Following code is considered part of the function until a
  <b>endfunc</b> command is encountered.  The code from <b>function</b>
  thru <b>endfunc</b> will not be executed when the function is being
  defined. User-defined functions are invoked just like intrinsic
  functions.

  <p>The code from <b>function</b> thru <b>endfunc</b> is an execution
  block.  This type of execution block can take arguments, which are taken
  from the function parameters.  Argument 0 is always the function name as
  it appeared in the function reference.  Any arguments supplied to the
  function will be available in the function routine as numbered arguments
  starting at 1.  The argument passing mechanism is the same as
  implemented by the <b>call</b> command for subroutines.  See the
  <b>call</b> command description (above) for how arguments are parsed and
  passed to the function.

  <p>The current version of the function name symbol becomes the previous
  version inside the function.  This means that the default is to call the
  previously-defined version of a function, not recursion, when using a
  function within itself.  It is possible for a function to call itself
  recursively by referencing the +1 relative version of the function name.

  <p>Consider this example, using ESCR program syntax:

  <pre>
  function +
    funcval [+ [arg 1] [arg 2] 1]
    endfunc
  show [+ 3 4] " " [+:1 3 4]</pre>

  <p>This script produces the output:

  <pre>
  8 7</pre>

  <p>The first command in the script defines a new version for the
  function "+".  Note that the function is not run at this time.  It is
  essentially stored so that it can be recalled and run later as needed.

  <p>When the <b>show</b> command envokes the "+" function, the
  user-defined version is run instead of the intrinsic version of "+".
  This user defined version assumes there are two integer arguments.  It
  returns their sum plus 1.  This results in the "8" written to the
  output.

  <p>Note that a "+" function is used inside the function.  The current
  version of a function is the one previous to the one that invoked the
  current code.  Outside the function, such as in the <b>show</b> command,
  "+" refers to the user-defined function.  Inside the user-defined
  function block, "+" refers to the previous version of that symbol, which
  is the intrinsic addition function.  The "+" reference in the
  <b>funcval</b> command therefore causes normal addition.  This is where
  the additional 1 is explicitly added.

  <p>The second invocation of the "+" function in the <b>show</b> command
  explicitly references the absolute version 1 of symbol "+", and
  therefore gets normal addtion with the result being 7 instead of 8.

  </p></indent>

<p><tt id="funcval"><b>FUNCVAL</b> <i>arg ... arg</i></tt></p><indent>

  <p>Appends the concatenation of the string representation of all the
  arguments to the return value of the innermost function being executed.
  This command is only allowed inside a function routine.

  <p>The resulting characters are returned by the function as a sequence
  of characters, not as a string.  Use the FUNCSTR command to return a
  string value.

  <p>The return value of a function is initialized to nothing.  Each
  FUNCVAL command adds characters to the return value.

  </p></indent>

<p><tt id="if"><b>IF</b> <i>condition [</i><b>then</b><i>]</i><br>
<b>THEN</b><br>
<b>ELSE</b><br>
<b>ENDIF</b>
</tt></p><indent>

  <p>These commands are used to conditionally execute sections of code.

  <p><i>Condition</i> is an expression of data type <b>bool</b>.  There
  are two forms of the <b>if</b> construct, depending on whether the
  optional <b>then</b> keyword is given on the <b>if</b> command line.

  <p>The general form without the <b>then</b> keyword on the <b>if</b>
  command line is:</p><indent>

    <p><tt><b>if</b> <i>condition</i><br>
        &nbsp;&nbsp;&nbsp;&nbsp;<i>code that is always executed</i><br>
      &nbsp;&nbsp;<b>then</b><br>
        &nbsp;&nbsp;&nbsp;&nbsp;<i>code executed when condition is true</i><br>
      &nbsp;&nbsp;<b>else</b><br>
        &nbsp;&nbsp;&nbsp;&nbsp;<i>code executed when condition is false</i><br>
      &nbsp;&nbsp;<b>endif</b><br></tt>

    <p>At least one of the <b>then</b> and <b>else</b> commands are
    required.

    </p></indent>

  <p>The general form with the <b>then</b> keyword on the <b>if</b>
  command line is:</p><indent>

    <p><tt><b>if</b> <i>condition</i> <b>then</b><br>
        &nbsp;&nbsp;&nbsp;&nbsp;<i>code executed when condition is true</i><br>
      &nbsp;&nbsp;<b>else</b><br>
        &nbsp;&nbsp;&nbsp;&nbsp;<i>code executed when condition is false</i><br>
      &nbsp;&nbsp;<b>endif</b><br></tt>

    <p>The <b>else</b> command is optional.

    </p></indent>

  </p></indent>

<p><tt id="include"><b>INCLUDE</b> <i>pathname</i></tt></p><indent>

  <p>Switch the input file to the indicated file.  When the end of that
  file is encountered, reading of the original file is resumed on the line
  following the <b>include</b> command.

  <p><i>Pathname</i> is a string.  It must therefore be enclosed in quotes
  or apostrophies if it is a constant.  See the <b>string</b> data type
  description for details.  The pathname is relative to the directory
  containing the current source file.

  </p></indent>

<p><tt id="loop"><b>LOOP</b> <i>[opt [arg]] ... [opt [arg]]</i></tt></p><indent>

  <p>Starts an execution block intended for looping.  The command name can
  be followed by a sequence of options, each of which may take arguments.
  Each <i>opt</i> parameter is a keyword, and is therefore
  case-insensitive.

  <p>There are several distinct loop types that can be created with this
  command.  The options used determine the loop type and its specific
  characteristics.  The loop types are:</p><indent>

    <h4 id="loop-unconditional">Unconditional</h4><indent>

      <p>This type of loop has no special looping logic or terminating
      condition.  <b>Repeat</b> and <b>endloop</b> will cause execution to
      jump to immediately after the <b>loop</b> command.  Only <b>Quit</b>
      will terminate the loop.

      <p>This loop type is a result of not specifying any loop options.

      </p></indent>

    <h4 id="loop-counted">Counted</h4><indent>

      <p>The loop iterates over a sequence of integer values.  There is a
      fixed non-zero increment of the loop value from one iteration to the
      next.  This increment can be positive or negative (the loop can count
      either up or down).

      <p>During loop execution, <b>repeat</b> and <b>endloop</b> update the
      loop value to the next iteration.  If the new value satisfies the
      terminating condition (if any), then the loop is terminated and
      execution proceeds after <b>endloop</b>.  If the new value does not
      satisfy the terminating condition or there is no terminating
      condition, execution jumps back to immediately after the <b>loop</b>
      command with the new iteration value in effect.

      <p>The loop parameters are determined and saved when the <b>loop</b>
      command is executed before the first iteration.  These parameters can
      not be changed by loop code.

      <p>The loop is not run at all if the initial loop value satisfies the
      terminating condition.

      <p>The <b>loop</b> command options for counted loops are:</p><indent>

        <p><tt id="loop-with"><b>with</b> <i>const</i></tt></p><indent>

          <p><i>Const</i> is the name of an integer constant that will be
          created before the loop is first run.  This constant will be set
          to the loop value before each iteration.  <i>Const</i> will be
          local to the loop block, so it will not exist after the loop
          terminates.

          <p>The default is that no constant is created.  In that case the
          loop code can not access the loop value.

          </p></indent>

        <p><tt id="loop-from"><b>from</b> <i>n</i></tt></p><indent>

          <p><i>N</i> is the loop value for the first iteration.  The
          default is 1.

          <p>The loop starting value is implied when both the <b>to</b> and
          <b>n</b> options are used.  All three of the <b>from</b>,
          <b>to</b>, and <b>n</b> options can not be used together.

          </p></indent>

        <p><tt id="loop-to"><b>to</b> <i>n</i></tt></p><indent>

          <p>Specifies the last valid loop value.  The loop terminates when
          the loop value would be past this ending value.  The meaning of
          "past" depends on the sign of the increment.  When the increment
          is positive, the loop terminates when the loop value would be &gt;
          <i>n</i>.   When the increment is negative, the loop terminates
          when the loop value would be &lt; <i>n</i>.  Note that the loop
          increment can not be 0.

          <p>When no ending value is specified, then there is no terminating
          condition and the loop repeats indefinitely.  In that case, the
          loop can only be ended with the <b>quit</b> command.

          <p>The loop ending value is implied when both the <b>from</b> and
          <b>n</b> options are used.  All three of the <b>from</b>,
          <b>to</b>, and <b>n</b> options can not be used together.

          </p></indent>

        <p><tt id="loop-n"><b>n</b> <i>n</i></tt></p><indent>

          <p>Specifies the number of loop iterations.

          <p>When no number of iterations is specified, there is no
          terminating condition and the loop repeats indefinitely.  In that
          case, the loop can only be ended with the <b>quit</b> command.

          <p>The number of iterations is implied when both the <b>from</b>
          and <b>to</b> options are used.  All three of the <b>from</b>,
          <b>to</b>, and <b>n</b> options can not be used together.

          </p></indent>

        <p><tt id="loop-by"><b>by</b> <i>n</i></tt></p><indent>

          <p>Specifies the amount to add to the loop value each iteration.
          This value must be non-zero.  The default is 1.

          </p></indent>

        </indent>

      <p>For example:</p><indent>

        <p><tt><b>loop with</b> ii <b>from</b> 3 <b>to</b>
        7</tt></p><indent>

          <p>Loop values: 3, 4, 5, 6, 7

          </p></indent>

        <p><tt><b>loop with</b> ii <b>from</b> 2 <b>to</b>
        -1</tt></p><indent>

          <p>Loop values: None.  The loop code is never executed.

          </p></indent>

        <p><tt><b>loop with</b> ii <b>from</b> 2 <b>to</b>
        -1 <b>by</b> -1</tt></p><indent>

          <p>Loop values: 2, 1, 0, -1

          </p></indent>

        <p><tt><b>loop with</b> ii <b>from</b> 2 <b>to</b> 7 <b>by</b>
        2</tt></p><indent>

          <p>Loop values: 2, 4, 6

          </p></indent>

        <p><tt><b>loop with</b> ii <b>n</b> 4 <b>from</b> 2 <b>by</b>
        3</tt></p><indent>

          <p>Loop values: 2, 5, 8, 11

          </p></indent>

        <p><tt><b>loop with</b> ii <b>n</b> 5 <b>by</b> -5 <b>to</b>
        100</tt></p><indent>

          <p>Loop values: 120, 115, 110, 105, 100

          </p></indent>

        <p><tt><b>loop n</b> 5</tt></p><indent>

          <p>Loop values: 1, 2, 3, 4, 5.  The loop value is not accessible
          to the loop code.

          </p></indent>

        </p></indent>

      </p></indent>

    <h4 id="loop-symbols">Symbols</h4><indent>

      <p>Loops once for each symbol that was defined when <b>loop</b> was
      first executed.  If a symbol is deleted by loop code before its
      iteration, then that iteration is skipped.

      <p>The <b>loop</b> command options for symbol loops are:</p><indent>

        <p><tt id="loop-sym"><b>symbols</b> <i>const [</i><b>VAR CONST VCON
        SUBR MACRO FUNC CMD LABEL</b><i>]</i></tt></p><indent>

          <p><i>Const</i> is the name of a constant of type <b>string</b>
          that will created.  It will be local to the loop block, so will
          not exist after the loop is ended.  This constant will contain the
          name of a different symbol each iteration.  <i>Const</i> is the
          name of the constant to create directly.  It is not a string.

          <p>The constant will be set to the fully qualified name of
          successive symbols in the list of symbols that was saved when the
          <b>loop</b> command was first executed.  Symbols newly created
          inside the block are therefore not on the list.

          <p>The optional keywords following <i>const</i> limit the types of
          symbols the loop will iterate over.  These keywords can appear
          multiple times and in any order.  The default without any keywords
          is to loop over all symbols.  When one or more keywords are
          listed, then only symbols of those types will be in the list.

          <p>The meanings of the keywords are:</p><indent>

            <p><tt><b>VAR</b></tt></p><indent>

              <p>Variables.

              </p></indent>

            <p><tt><b>CONST</b></tt></p><indent>

              <p>Contants.

              </p></indent>

            <p><tt><b>VCON</b></tt></p><indent>

              <p>Variables or constants.  This is equivalent to specifying
              <b>VAR</b> and <b>CONST</b>.

              </p></indent>

            <p><tt><b>SUBR</b></tt></p><indent>

              <p>Subroutines.

              </p></indent>

            <p><tt><b>MACRO</b></tt></p><indent>

              <p>Macros.

              </p></indent>

            <p><tt><b>FUNC</b></tt></p><indent>

              <p>Functions.

              </p></indent>

            <p><tt><b>CMD</b></tt></p><indent>

              <p>Commands.

              </p></indent>

            <p><tt><b>LABEL</b></tt></p><indent>

              <p>Labels.

              </p></indent>

            </p></indent>

          </p></indent>

        </p></indent>

      </p></indent>

    <h4 id="loop-directory">Directory</h4><indent>

      <p>Loops over all the entries in a directory.

      <p>The <b>loop</b> command options for directory loops are:</p><indent>

        <p><tt id="loop-dir"><b>dir</b> <i>dirname [</i><b>FILE
          LINK DIR</b><i>]</i></tt></p><indent>

          <p><i>Dirname</i> is the name of the directory to enumerate.
          <i>Dirname</i> is a string.  It can therefore, for example, be a
          fixed name in quotes, or the name of a string variable.

          <p>The optional keywords <b>file</b>, <b>link</b>, and
          <b>dir</b> specify the type of file system objects to list.
          These keywords can appear in any order and may be repeated.
          When none of these keywords are supplied, then all directory
          entries are included. When one or more of these keywords is
          supplied, then only those objects matching at least one of the
          keywords are included.

          <p>The meaning of each keyword is:</p><indent>

            <p><tt><b>FILE</b></tt></p><indent>

              <p>Ordinary data file.

              </p></indent>

            <p><tt><b>LINK</b></tt></p><indent>

              <p>Symbolic link.

              </p></indent>

            <p><tt><b>DIR</b></tt></p><indent>

              <p>Nested directory (subdirectory).

              </p></indent>

            </p></indent>

          </p></indent>

        </p></indent>

      <p>The loop will iterate once for each matching directory entry. Use
      the <b><a href="func.htm#dent">dent</a></b> function to access the
      information about the directory entry for the current iteration.

      </p></indent>

    </p></indent>

  <p>Execution will return to immediately after the <b>loop</b> command
  with the loop state set to the next iteration when <b>repeat</b> or
  <b>endloop</b> is executed, and the terminating condition is not met by
  the new iteration state.

  <p>The loop is ended when any of the following conditions are met:<ul>

    <li><b>repeat</b> is excecuted and the new iteration state meets the
    terminating condition.

    <li><b>endloop</b> is excecuted and the new interation state meets the
    terminating condition.

    <li><b>quit</b> is executed.

    </ul>

  <p>Ending the loop means that execution continues after the
  <b>endloop</b> command, and that any resources allocated when
  <b>loop</b> was first executed are released.  This includes deleting all
  local variables created inside the loop.

  <p><b>Loop</b> and <b>endloop</b> form an execution block.  This type of
  execution block does not take arguments.  The <b>arg</b> inline function
  will resolve arguments of the next enclosing execution block that does
  take arguments.

  </p></indent>

<p><tt id="macro"><b>MACRO</b> <i>name</i></tt></p><indent>

  <p>Defines a macro.  These are defined just like subroutines, except
  that the definition starts with <b>macro</b> and ends with
  <b>endmac</b>.

  <p>Macros differ from subroutines in how they are called.  A macro is
  called just like a native assembler macro.  If the macro name appears
  syntactically as an opcode, then the macro is run and its output
  replaces the macro invocation line.

  <p>Arguments can be passed to the macro by placing them following the
  macro name on the macro invocation line.  Argument handling inside the
  macro is identical to that of subroutine.  See the <b>call</b> command
  description for more details on arguments.  Note that the call argument
  syntax in the macro invocation differs from the <b>call</b> command.
  Macro arguments are separated by commas with any number of spaces before
  and after each comma.

  <p>If a label preceeds the macro invocation on the same line, then the
  special argument -1 is created that will be the label name.  The special
  argument 0 is the macro name as given by <i>name</i>.

  <p>The macro invocation syntax is deliberately compatible with the MPASM
  macro invocation and instruction syntax.  This allows, for example,
  existing MPASM directives or instructions to be "hooked" to execute
  preprocessor code.

  <p>Following code is considered part of the macro until an <b>endmac</b>
  command is encountered.  The code from <b>macro</b> thru <b>endmac</b>
  will not be executed when the macro is being defined.

  <p>A <b>macro</b> ... <b>endmac</b> is an execution block that can take
  arguments.

  </p></indent>

<p><tt id="quit"><b>QUIT</b></tt></p><indent>

  <p>Exits the current execution block.  Execution resumes with parameters
  in effect before the block was entered.  Resources used internally in
  the script system to manage the block are deallocated and local
  variables defined in the block are deleted.

  </p></indent>

<p><tt id="quitmac"><b>QUITMAC</b></tt></p><indent>

  <p>Stops execution of a macro.  Execution is returned to the line
  following the macro invocation.

  </p></indent>

<p><tt id="repeat"><b>REPEAT</b></tt></p><indent>

  <p>Go back to immediately after the command that started the current
  execution block.

  <p>If the execution block is a loop (started with <b>loop</b>), then the
  loop state is advanced to the next iteration and execution only returns
  to the start of the block if the new iteration state does not meet the
  terminating condition.  If the new iteration state does meet the
  terminating condition, then the loop is ended and execution resumes
  immediately after the end of the block (functions like <b>quit</b>).

  </p></indent>

<p><tt id="return"><b>RETURN</b></tt></p><indent>

  <p>Ends the execution of the current subroutine, user-defined command,
  or user-defined function.  Execution resumes after where the routine was
  invoked.

  </p></indent>

<p><tt id="run"><b>RUN</b> <i>arg ... arg</i></tt></p><indent>

  <p>Runs a external program.  The concatenation of the string
  representation of all the arguments form the command line to execute.
  The first token of this resulting string must be the name of something
  the underlying operating system can execute.  The remaining tokens are
  passed to that executable, and are generally interpreted as command line
  arguments by that executable.

  <p>The integer variable <tt>EXITSTATUS</tt> is set to the exit status
  code of the program that was executed.  This variable is created if it
  does not already exist.

  </p></indent>

<p><b><tt id="set">SET</b> <i>name value</i></tt></p><indent>

  <p>Set the variable <i>name</i> to the value <i>value</i>.  It is an
  error if <i>value</i> can not be converted to the data type of
  <i>name</i>, or if there is no such variable.

  </p></indent>

<p><tt id="show"><b>SHOW</b> <i>arg ... arg</i></tt></p><indent>

  <p>Write the concatenation of the string representation of all arguments
  as one line to standard output.  If no arguments are supplied, then a
  blank line is written.

  </p></indent>

<p><tt id="stop"><b>STOP</b> <i>[exstat]</i></tt></p><indent>

  <p>Completely ends this run of the script or preprocessor input file. No
  more input file is read, and no more output file written.  Any open
  output files are closed, and the program exits.

  <p>The script exit status is set according to the following rules, in
  decending precedence:<ol>

    <li><i>Exstat</i>, if present.

    <li>The value of the integer variable EXITSTATUS, if it exists.  Note
    that this variable is automatically set (and created if needed) to the
    exit status returned by any external program run from the script.

    <li>The exit status of the last nested script the application ran if
    the script state was not cleared afterwards.

    <li>0.

    </ol>

  <p>The script exit status is made available to the application program.
  It is up to each application program what, if anything, to do with it.
  The ESCR program returns the the script exit status code as its own
  program exit status code.

  </p></indent>

<p><tt id="subroutine"><b>SUBROUTINE</b> <i>name</i></tt></p><indent>

  <p>Define the entry point of a subroutine and define the symbol
  <i>name</i> to refer to that subroutine.  The symbol <i>name</i> will
  now refer to the new subroutine regardless of its previous meaning, if
  any.  <i>Name</i> will revert to its previous meaning when this symbol
  is deleted.

  <p>Following code is considered part of the subroutine until an
  <b>endsub</b> command is encountered.  The code from <b>subroutine</b>
  thru <b>endsub</b> will not be executed when the subroutine is being
  defined.  Subroutines are executed by using a <b>call</b> command,
  described below.

  <p>The code from <b>subroutine</b> thru <b>endsub</b> is an execution
  block.  This type of execution block can take arguments, which can be
  set with the <b>call</b> command.  Argument 0 is always the subroutine
  name as it appeared in the <b>call</b> command.  The arguments passed
  from the <b>call</b> command are numbered sequentially starting at 1.

  </p></indent>

<p><tt id="sylist"><b>SYLIST</b></tt></p><indent>

  <p>Write the list of all currently defined symbols and their values to
  the output file as data file comments.  It is an error if there is no
  current output file.

  </p></indent>

<p><tt id="var-exist"><b>VAR EXIST</b> <i>name [dtype] [</i><b>=</b>
<i>value]</i></tt></p><indent>

  <p>Like <b>var new</b>, except that no new variable is created if
  <i>name</i> is already a variable or constant of the indicated type.

  <p>If a new variable is created, then it will be initialized to
  <i>value</i>, if supplied, else it will be initialized to the default
  for its data type.  If the variable previously existed, then its
  existing value is preserved, whether <i>value</i> is supplied or not.

  </p></indent>

<p><tt id="var-local"><b>VAR LOCAL</b> <i>name [dtype] [</i><b>=</b>
<i>value]</i></tt></p><indent>

  <p>Like <b>var new</b> except for the following:<ul>

    <li>The new variable will be automatically deleted at the end of the
    current execution block.  Examples of execution blocks are subroutines
    and explicit blocks defined with the <b>block</b> command.

    <li>The action is only performed on the first iteration thru the
    execution block.  This allows the command to be put inside a
    <b>loop</b> ... <b>endloop</b> block, for example, but the variable
    only created on the first pass.  Even if a local variable is not
    created on the first pass due to conditional logic, it will not be
    created on subsequent passes if the <b>var local</b> command for that
    variable is run then.  It is recommended that <b>var local</b>
    commands therefore be placed at the start of the block and before any
    conditional logic.

    <p>"First iteration" means the first pass thru the block after each
    time it is entered, not the first time globally.

    </ul>

  </p></indent>

<p><tt id="var-new"><b>VAR NEW</b> <i>name [dtype] [</i><b>=</b>
<i>value]</i></tt></p><indent>

  <p>Create a new variable of name <i>name</i>.  The symbol <i>name</i>
  will now refer to the new variable regardless of a previously existing
  variable or constant of the same name.  <i>Name</i> will revert to its
  previous meaning when this symbol is deleted.

  <p><i>Dtype</i> specifies the data type of the variable.  The default
  data type is <b>string</b>.

  <p>The variable will be set to the <i>value</i>, if supplied.  Otherwsie
  the variable's value will be the default for its data type.

  </p></indent>

<p><tt id="write"><b>WRITE</b> <i>arg ... arg</i></tt></p><indent>

  <p>Write the concatenation of the string representation of all arguments
  as one line to the current output file.  If no arguments are supplied,
  then a blank line is written.

  <p>It is an error if there is no current output file.

  </p></indent>

<p><tt id="writepop"><b>WRITEPOP</b></tt></p><indent>

  <p>Ends writing to the file started with the most recently executed
  WRITEPUSH command.  The output file is restored to what it was when
  WRITEPUSH was executed.  In preprocessor mode, it is not possible to
  stop writing to the original output file.

  </p></indent>

<p><tt id="writepush"><b>WRITEPUSH</b> <i>name</i></tt></p><indent>

  <p>Set the file that subsequent WRITE commands write to.  The current
  output file can be restored with the WRITEPOP command.  <i>Name</i> is a
  string, and indicates the name of the new output file.  The file is
  created if it does not previously exist, and is overwritten if it does.

  <p>In preprocessor mode, there is always a output file.  The top level
  output file is the file being pre-processed into.

  <p>In script mode, there is no output file until one is explicitly set
  up with the WRITEPUSH command.  It is a error to attempt to write to the
  output file when there is no output file.

  </p></indent>


<hr><!-- ******************************************************************* -->

<ul>
  <li><a href="func.htm">Next page</a>
  <li><a href="sym.htm">Previous page</a>
  <li><a href="index.htm">Master index</a>
  </ul>

</body>
</html>
